---
import BaseLayout from "../../components/layout/BaseLayout/BaseLayout.astro";
import ServicesGrid from "../../components/sections/ServicesGrid/ServicesGrid.astro";
import ProjectsList from "../../components/sections/ProjectsList/ProjectsList.astro";
import Workshops from "../../components/sections/Workshops/Workshops.astro";
import { getEntry } from "astro:content";

const lang = "en";
const otherHref = "/que-hacemos";

type Service = {
  nombre?: string;
  objetivo?: string;
  destinatarios?: string;
  requisitos?: string;
  horario_lugar?: string;
  como_solicitar?: string;
  accesibilidad?: string;
};

type Project = {
  titulo?: string;
  financiacion?: string;
  resultados?: string;
  notas?: string;
  url?: string;   // optional external link
  fecha?: string; // optional year/range, e.g. "2023â€“2024"
};

type WorkshopImg = { src: string; alt?: string };
type Workshop = {
  titulo?: string;
  descripcion?: string;
  horario_lugar?: string;
  imagenes?: WorkshopImg[];
};

type PageData = {
  title?: string;
  description?: string;
  heroTitle?: string;
  heroSubtitle?: string;
  servicios?: Service[];   // you can rename to "services" if you prefer; update YAML/code accordingly
  proyectos?: Project[];   // projects
  talleres?: Workshop[];   // workshops
};

const entry = await getEntry({ collection: "pages", id: "en/what-we-do" });
const data = (entry?.data ?? {}) as PageData;

const pageTitle = data.heroTitle ?? data.title ?? "What we do";
---

<BaseLayout lang={lang} title={data.title} description={data.description} otherHref={otherHref}>
  <section class="container py-4">
    <h1 class="display-5 fw-bold">{pageTitle}</h1>
    {data.heroSubtitle && <p class="fs-5">{data.heroSubtitle}</p>}

    <article class="content mt-4">
      {Array.isArray(data.servicios) && data.servicios.length > 0 && (
        <ServicesGrid lang={lang} items={data.servicios} />
      )}

      {Array.isArray(data.proyectos) && data.proyectos.length > 0 && (
        <ProjectsList lang={lang} items={data.proyectos} />
      )}

      {Array.isArray(data.talleres) && data.talleres.length > 0 && (
        <Workshops lang={lang} items={data.talleres} />
      )}
    </article>
  </section>
</BaseLayout>
